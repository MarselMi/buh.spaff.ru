{% extends 'mainapp/base.html' %}
{% load static %}
{% block content %}

	<div class="row mb-4">
		<div class="col-12">
			<div class="card">
				<div class="card-body">
					<div class="card-header d-flex align-items-center card-header-no-bg">
						<div class="card-title h6 fw-bold text-uppercase border-start border-primary border-3 ps-2 mb-3">
							Фильтр
						</div>
						{% if user.is_superuser or user.is_staff %}
						<div class="card-options ms-auto">
							<a href="{% url 'transaction_create' %}" class="btn btn-primary btn-sm">Создать транзакцию</a>
						</div>
						{% endif %}
					</div>
					<div class="card-body">
						<form action="">
						
							<div class="row">

								<div class="col-12 col-sm-3 mb-3">
									<label class="label" for="filter_name">Наименование транзакии</label>
									<input class="form-control filter" autocomplete="off" list="transaction_name" name="name" id="filter_name"
										   {% if get_param_filter.name.0 %} value="{{ get_param_filter.name.0 }}" {% endif %} placeholder="Имя транзакции"/>
									<datalist id="transaction_name">
										{% for transaction in transactions %}
										<option value="{{ transaction.name }}">{{ transaction.name }}</option>
										{% endfor %}
									</datalist>
								</div>

								<div class="col-12 col-sm-3 mb-3">
									<label for="filter_holder">Балансодержатель</label>
									<input class="form-control filter" list="balance_holder" onfocus="this.value=''" autocomplete="off" name="balance_holder_id" id="filter_holder"
										    {% if get_param_filter.balance_holder_id.0 %} value="{{ get_param_filter.balance_holder_id.0 }}" {% endif %} placeholder="Балансодержатель"/>
									<datalist id="balance_holder">
										{% for holder in balance_holders %}
										<option value="{{ holder.organization_holder }}">{{ holder.organization_holder }}</option>
										{% endfor %}
									</datalist>
								</div>

								<div class="col-12 col-sm-3 mb-3">
									<label for="filter_payment">Категория</label>
									<input class="form-control filter" list="pay_type" autocomplete="off" onfocus="this.value=''" name="type_payment_id" id="filter_payment"
										   {% if get_param_filter.type_payment_id.0 %} value="{{ get_param_filter.type_payment_id.0 }}" {% endif %} placeholder="Офис"/>
									<datalist id="pay_type">
										{% for type in type_payments %}
										<option value="{{ type }}">{{ type }}</option>
										{% endfor %}
									</datalist>
								</div>

								<div class="col-12 col-sm-3 mb-3">
									<label for="filter_sub_payment">Подкатегория</label>
									<input class="form-control filter" list="sub_type" autocomplete="off" onfocus="this.value=''" name="sub_type_pay_id" id="filter_sub_payment"
										   {% if get_param_filter.sub_type_pay_id.0 %} value="{{ get_param_filter.sub_type_pay_id.0 }}" {% endif %} placeholder="Аренда"/>
									<datalist id="sub_type">
										{% for type in sub_type %}
											<option value="{{ type }}">{{ type }}</option>
										{% endfor %}
									</datalist>
								</div>

							</div>

							<div id="accordionStatsDaysFilter">
								<div id="collapseStatsDaysFilter-1" class="accordion-collapse collapse{% if collapsed == 2 %}{% else %} show{% endif %}" aria-labelledby="flush-headingOne" data-bs-parent="#accordionStatsDaysFilter" style="">
									<div class="row">

										<div class="col-12 col-sm-3 mb-3">

											<label for="input-date-group">
												Период
											</label> <!-- /form-label -->

											<div class="input-group" id="input-date-group">
												<span class="input-group-text">С</span>
												<input class="form-control filter" type="text" placeholder="01.01.2023" name="start"
													   {% if get_param_filter.start.0 %} value="{{ get_param_filter.start.0 }}" {% endif %} id="datepicker"/>
												<span class="input-group-text">По</span>
												<input class="form-control filter" type="text" placeholder="01.01.2023" name="end"
													   {% if get_param_filter.end.0 %} value="{{ get_param_filter.end.0 }}" {% endif %} id="datepicker1"/>
											</div> <!-- /input-group -->

										</div> <!-- /col -->

										<div class="col-12 col-sm-3 mb-3">
											<label for="filter_autor">Автор создания</label>
											<input class="form-control filter" list="user_filter" autocomplete="off" name="author_id" id="filter_autor"
												   {% if get_param_filter.author_id.0 %} value="{{ get_param_filter.author_id.0 }}" {% endif %} placeholder="admin"/>
											<datalist id="user_filter">
												{% for author in authors %}
													<option value="{{ author }}">{{ author }}</option>
												{% endfor %}
											</datalist>
										</div> <!-- /col -->

										<div class="col-12 col-sm-3 mb-3">
											<label for="filter_type">Тип транзакции</label>
											<select class="form-select filter" autocomplete="off" name="type_transaction" id="filter_type">
												{% if get_param_filter.type_transaction.0 %}
													<option selected value="{{ get_param_filter.type_transaction.0 }}">{{ get_param_filter.type_transaction.0|trans_type }}</option>
													<option value="">Выберите тип транзакции</option>
													<option value="COMING">Приход</option>
													<option value="EXPENDITURE">Расход</option>
												{% else %}
													<option value="">Выберите тип транзакции</option>
													<option value="COMING">Приход</option>
													<option value="EXPENDITURE">Расход</option>
												{% endif %}
											</select>
										</div> <!-- /col -->

										<div class="col-12 col-sm-3 mb-3">
											<label for="filter_tags">По тегу</label>
											<input class="form-control filter" autocomplete="off" name="tags" id="filter_tags"
											{% if get_param_filter.tags.0 %} value="{{ get_param_filter.tags.0 }}" {% endif %} placeholder="Введите теги"/>
										</div>

										<div class="col-12 col-sm-3 mb-3">
											<label class="label" for="filter_status">По статусу</label>
											<select class="form-select filter" autocomplete="off" name="status" id="filter_status">
												{% if get_param_filter.status.0 %}
													<option selected value="{{ get_param_filter.status.0 }}">{{ get_param_filter.status.0|trans_status }}</option>
													<option value="">Выберите статус транзакции</option>
													<option value="SUCCESSFULLY">Успешно</option>
													<option value="INPROCESS">В процессе</option>
													<option value="REJECT">Отклонен</option>
												{% else %}
													<option value="">Выберите статус транзакции</option>
													<option value="SUCCESSFULLY">Успешно</option>
													<option value="INPROCESS">В процессе</option>
													<option value="REJECT">Отклонен</option>
												{% endif %}
											</select>
										</div> <!-- /col -->

										<div class="col-12 col-sm-3 mb-3">

											<label for="input-amount-group">
												По сумме
											</label>

											<div class="input-group" id="input-amount-group">
												<span class="input-group-text">Мин: </span>
												<input class="form-control filter" autocomplete="off" name="amount_start" id="filter_amount_higher"
												{% if get_param_filter.amount_start.0 %} value="{{ get_param_filter.amount_start.0 }}" {% endif %} placeholder="500"/>
												<span class="input-group-text">Макс: </span>
												<input class="form-control filter" autocomplete="off" name="amount_end" id="filter_amount_below"
												{% if get_param_filter.amount_end.0 %} value="{{ get_param_filter.amount_end.0 }}" {% endif %} placeholder="2000"/>
											</div>
										</div> <!-- /col -->

									</div>
								</div>
							</div>

							<div class="row">

								<div class="col-12">

									{% if collapsed == 2 %}
										<button onclick="$(this).text($(this).text() == 'Скрыть' ? 'Раскрыть' : 'Скрыть'); checkCollapse()" type="button" class="btn btn-secondary text-white collapsed" data-bs-toggle="collapse" data-bs-target="#collapseStatsDaysFilter-1" aria-expanded="false" aria-controls="collapseStatsDaysFilter-1">Раскрыть</button>
									{% else %}
										<button onclick="$(this).text($(this).text() == 'Раскрыть' ? 'Скрыть' : 'Раскрыть'); checkCollapse()" type="button" class="btn btn-secondary text-white" data-bs-toggle="collapse" data-bs-target="#collapseStatsDaysFilter-1" aria-expanded="true" aria-controls="collapseStatsDaysFilter-1">Скрыть</button>
									{% endif %}

									<button type="submit" class="btn btn-primary ms-3">
										Показать
									</button>

									<button type="button" onclick="cleare_filter()" class="clear btn btn-light ms-3" hidden="">
										Сбросить
									</button>

								</div>
							</div>

						</form>
					</div>
					<div class="table-responsive">
						{% if transactions %}
						<div class="card-body">
							<div class="table-responsive">
								<table class="table table-bordered text-nowrap mb-0">
									<thead class="text-center">
										<tr>
											<th>Балансодержатель</th>
											<th>Название</th>
											<th>Категория</th>
											<th>Создан</th>
											<th>Изменён</th>
											<th>Проведен</th>
											<th>Сумма</th>
											<th>Комиссия</th>
											<th>Транзакция</th>
											<th>Статус</th>
											<th>Чек</th>
											<th>Автор</th>
										</tr>
									</thead>
									<tbody class="text-center">
									{% for object in transactions %}
										<tr class="align-middle">
											<td>{{ object.balance_holder }}</td>
											<td>
												<div class="d-flex justify-content-between bd-highlight">
													<div class="d-flex justify-content-start">
														{% if object.description %}
														<span data-bs-toggle="tooltip" data-bs-title="Подробнее: {{ object.description }}">
															{{ object.name }}
														</span>
														{% else %} 
															{{ object.name }} 
														{% endif %}
													</div>
													<div class="d-flex justify-content-end">
														{% if user.is_superuser %}
															<a href="{% url 'transaction_edit' object.id %}" class="btn btn-light btn-sm" data-bs-toggle="tooltip" data-bs-title="Редактировать">
																<i class="fa-regular fa-pen-to-square"></i>
															</a>
														{% endif %}
													</div>
												</div>
											</td>
											<td>
												{% if object.sub_type_pay_id %}
													{{ object.type_payment }} &ensp;
													<span data-bs-toggle="tooltip" data-bs-title="Подкатегория: {{ object.sub_type_pay_id }}">
														<i class="fa-regular fa-info"></i>
													</span>
												{% else %}
													{{ object.type_payment }}
												{% endif %}
											</td>
											<td>
												<span data-bs-toggle="tooltip" data-bs-title="{{ object.create_date|datetime_format }}">
														{{ object.create_date|datetime_without_sec }}
												</span>
											</td>
											<td>
												{% if object.update_date %}
													<span data-bs-toggle="tooltip" data-bs-title="{{ object.update_date|datetime_format|safe }}">
														{{ object.update_date|datetime_without_sec|safe }}
													</span>
												{% else %}
													&ndash;
												{% endif %}
											</td>
											<td>{{ object.transaction_date|date_format }}</td>
											<td>

												{% if object.commission %}
													{% if object.current_transaction %} 
														<span data-bs-toggle="tooltip" data-bs-title="RUB: {{ object.amount|numb_format }}; {{object.current_transaction}}: {{ object.current_amount|numb_format }}">
															{{ object.transaction_sum|numb_format }}
														</span>
													{% else %}
														<span data-bs-toggle="tooltip" data-bs-title="{{ object.amount|numb_format }}">
															{{ object.transaction_sum|numb_format }}
														</span>
													{% endif %}
												{% else %}
													{{ object.transaction_sum|numb_format }}
												{% endif %}

												{% if object.current_transaction == 'USD' %}
													<span data-bs-toggle="tooltip" data-bs-title="{{object.current_transaction}}: {{ object.current_sum|numb_format }}">
														<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-currency-dollar" viewBox="0 0 16 16">
															<path d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718H4zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73l.348.086z"/>
														</svg>
													</span>
												{% elif object.current_transaction == 'USDT' or object.current_transaction == 'ETH' %}
													<span data-bs-toggle="tooltip" data-bs-title="{{object.current_transaction}}: {{ object.current_sum|numb_format }}"> 
														<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-currency-bitcoin" viewBox="0 0 16 16">
															<path d="M5.5 13v1.25c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25V13h.5v1.25c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25V13h.084c1.992 0 3.416-1.033 3.416-2.82 0-1.502-1.007-2.323-2.186-2.44v-.088c.97-.242 1.683-.974 1.683-2.19C11.997 3.93 10.847 3 9.092 3H9V1.75a.25.25 0 0 0-.25-.25h-1a.25.25 0 0 0-.25.25V3h-.573V1.75a.25.25 0 0 0-.25-.25H5.75a.25.25 0 0 0-.25.25V3l-1.998.011a.25.25 0 0 0-.25.25v.989c0 .137.11.25.248.25l.755-.005a.75.75 0 0 1 .745.75v5.505a.75.75 0 0 1-.75.75l-.748.011a.25.25 0 0 0-.25.25v1c0 .138.112.25.25.25L5.5 13zm1.427-8.513h1.719c.906 0 1.438.498 1.438 1.312 0 .871-.575 1.362-1.877 1.362h-1.28V4.487zm0 4.051h1.84c1.137 0 1.756.58 1.756 1.524 0 .953-.626 1.45-2.158 1.45H6.927V8.539z"/>
														</svg>
													</span>
												{% elif object.current_transaction == 'EUR' %}
													<span data-bs-toggle="tooltip" data-bs-title="{{object.current_transaction}}: {{ object.current_sum|numb_format }}"> 
														<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-currency-euro" viewBox="0 0 16 16">
															<path d="M4 9.42h1.063C5.4 12.323 7.317 14 10.34 14c.622 0 1.167-.068 1.659-.185v-1.3c-.484.119-1.045.17-1.659.17-2.1 0-3.455-1.198-3.775-3.264h4.017v-.928H6.497v-.936c0-.11 0-.219.008-.329h4.078v-.927H6.618c.388-1.898 1.719-2.985 3.723-2.985.614 0 1.175.05 1.659.177V2.194A6.617 6.617 0 0 0 10.341 2c-2.928 0-4.82 1.569-5.244 4.3H4v.928h1.01v1.265H4v.928z"/>
														</svg>
													</span>
												{% endif %}

											</td>
											<td>

												{% if object.commission %}
													<span data-bs-toggle="tooltip" data-bs-title="{{ object.percent }}%">
														{{ object.commission|numb_format }}
													</span>
												{% else %}
													&ndash;
												{% endif %}

											</td>
											<td>
												{% if object.type_transaction == 'COMING' %}
													<span class="badge text-bg-outline-success d-flex align-items-center justify-content-center rounded-pill">
														Приход
													</span>
												{% else %}
													<span class="badge text-bg-outline-danger d-flex align-items-center justify-content-center rounded-pill">
														Расход
													</span>
												{% endif %}
											</td>
											<td>
												{% if object.status == 'INPROCESS' %}
													<span class="badge text-bg-outline-info d-flex align-items-center justify-content-center rounded-pill">
														В процессе
													</span>
												{% elif object.status == 'SUCCESSFULLY' %}
													<span class="badge bg-warning d-flex align-items-center justify-content-center rounded-pill ms-auto my-auto">
														Успешно
													</span>
												{% else %}
													<span class="badge text-bg-outline-danger d-flex align-items-center justify-content-center rounded-pill">
														Отклонено
													</span>
												{% endif %}
											</td>
											<td>
												{% if object.check_img %}
												<button data-bs-whatever="/media/{{ object.check_img }}"
														type="button" 
														class="btn CheckPhotoModal"
														data-bs-transaction-name="{{ object.name }}"
														data-bs-toggle="modal"
														data-bs-target="#exampleModal">
													<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-image" viewBox="0 0 16 16">
													  <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
													  <path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13zm13 1a.5.5 0 0 1 .5.5v6l-3.775-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12v.54A.505.505 0 0 1 1 12.5v-9a.5.5 0 0 1 .5-.5h13z"/>
													</svg>
												</button>
												{% else %}
												&ndash;
												{% endif %}
											</td>
											<td>{{ object.author }}</td>
										</tr>
									{% endfor %}
									</tbody>
									<tfoot>
										<tr>
											<th rowspan="2">Входящие транзакции: {{ coming_sum|numb_format }}
											</th>

											<th rowspan="2">
												Исходящие транзакции: {{ expenditure_amount|numb_format }}
											</th>
											<th>
												Сумма перевода - {{ expenditure_transaction|numb_format }}
											</th>
										</tr>
										<tr>
											<th>Комиссия - {{ expenditure_comission|numb_format }}
											</th>
										</tr>
									</tfoot>
								</table> <!-- /table -->

							</div> <!-- /table-responsive -->
							
							<div class="pagin_list">
								{% if count > 1 %}
									<nav id="pagination" class="col align-self-center mt-4" aria-label="Page navigation example">
										<ul class="pagination mb-0">
										{% if page > 1 %}
											{% if url_params %}
												<li class="page-item"><a class="page-link" href="{{url_params}}&page={{ 1 }}">&laquo;</a></li>
											{% else %}
												<li class="page-item"><a class="page-link" href="{{url_params}}?page={{ 1 }}">&laquo;</a></li>
											{% endif %}
										{% else %}
											<li class="page-item disabled"><span class="page-link" href="" tabindex="-1" aria-disabled="true">&laquo;</span></li>
										{% endif %}
										{% for p in count|create_range %}
											{% if p > page|add:-4 and p < page|add:4 %}
												{% if p|increment_page == count %}
													{% if page == p|increment_page %}
														{% if url_params %}
															<li class="page-item active" aria-current="page"><a class="page-link" href="{{url_params}}&page={{ p|increment_page }}">{{ limit|multiply:p|add:1 }}-{{ original_count }}<span class="sr-only">{{ page }}</span></a></li>
														{% else %}
															<li class="page-item active" aria-current="page"><a class="page-link" href="{{url_params}}?page={{ p|increment_page }}">{{ limit|multiply:p|add:1 }}-{{ original_count }}<span class="sr-only">{{ page }}</span></a></li>
														{% endif %}
													{% else %}
														{% if url_params %}
															<li class="page-item"><a class="page-link" href="{{url_params}}&page={{ p|increment_page }}">{{ limit|multiply:p|add:1 }}-{{ original_count}}</a></li>
														{% else %}
															<li class="page-item"><a class="page-link" href="{{url_params}}?page={{ p|increment_page }}">{{ limit|multiply:p|add:1 }}-{{ original_count }}</a></li>
														{% endif %}
													{% endif %}
												{% elif page == p|increment_page %}
													{% if url_params %}
														<li class="page-item active" aria-current="page"><a class="page-link" href="{{url_params}}&page={{ p|increment_page }}">{{ limit|multiply:p|add:1 }}-{{ limit|multiply:p|add:limit }}<span class="sr-only">{{ page }}</span></a></li>
													{% else %}
														<li class="page-item active" aria-current="page"><a class="page-link" href="{{url_params}}?page={{ p|increment_page }}">{{ limit|multiply:p|add:1 }}-{{ limit|multiply:p|add:limit }}<span class="sr-only">{{ page }}</span></a></li>
													{% endif %}
												{% else %}
													{% if url_params %}
														<li class="page-item"><a class="page-link" href="{{url_params}}&page={{ p|increment_page }}">{{ limit|multiply:p|add:1 }}-{{ limit|multiply:p|add:limit }}</a></li>
													{% else %}
														<li class="page-item"><a class="page-link" href="{{url_params}}?page={{ p|increment_page }}">{{ limit|multiply:p|add:1 }}-{{ limit|multiply:p|add:limit }}</a></li>
													{% endif %}
												{% endif %}
											{% endif %}
										{% endfor %}
										{% if page < count %}
											{% if url_params %}
												<li class="page-item"><a class="page-link" href="{{url_params}}&page={{ count }}">&raquo;</a></li>
											{% else %}
												<li class="page-item"><a class="page-link" href="{{url_params}}?page={{ count }}">&raquo;</a></li>
											{% endif %}
										{% else %}
											<li class="page-item disabled"><span class="page-link" href="" tabindex="-1" aria-disabled="true">&raquo;</span></li>
										{% endif %}
										</ul>
									</nav>
								{% endif %}
							</div>

							<div class="mt-4 mb-4">

								{% if limit == 25 %}

									<button type="button" id="limit25" class="checkLimitButton btn btn-secondary btn-sm me-2" disabled>
										По 25
									</button>

									<button type="button" id="limit50" class="checkLimitButton btn btn-secondary btn-sm me-2">
										По 50
									</button>

									<button type="button" id="limit100" class="checkLimitButton btn btn-secondary btn-sm me-2">
										По 100
									</button>

								{% elif limit == 50 %}

									<button type="button" id="limit25" class="checkLimitButton btn btn-secondary btn-sm me-2">
										По 25
									</button>

									<button type="button" id="limit50" class="checkLimitButton btn btn-secondary btn-sm me-2" disabled>
										По 50
									</button>

									<button type="button" id="limit100" class="checkLimitButton btn btn-secondary btn-sm me-2">
										По 100
									</button>

								{% else %}

									<button type="button" id="limit25" class="checkLimitButton btn btn-secondary btn-sm me-2">
										По 25
									</button>

									<button type="button" id="limit50" class="checkLimitButton btn btn-secondary btn-sm me-2">
										По 50
									</button>

									<button type="button" id="limit100" class="checkLimitButton btn btn-secondary btn-sm me-2" disabled>
										По 100
									</button>

								{% endif %}

							</div> <!-- /btn-select-rows -->
							
						</div>
						{% else %}
						<div class="alert alert-warning" role="alert">
							<h5 class="alert-heading text-center">
								<i class="fa-regular fa-octagon-exclamation me-2"></i>
								Нет доступных транзакций
							</h5>
						</div>
						{% endif %}
					</div> <!-- /table-responsive -->
				</div> <!-- /card-body -->
			</div> <!-- /card -->
		</div> <!-- /col -->
	</div> <!--/row-->

	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1"
		 role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel"> </h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				...
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-bs-dismiss="modal" aria-label="Close">Закрыть</button>
			</div>
			</div>
		</div>
	</div>

	<script>

		var url = document.location.href;
		var a = document.cookie.split(';');
		var token = ''

		for (i = 0; i < a.length; i++) {
			var b = a[i].split('=')
			b[0] = b[0].replace(/\s+/g, '')
			if (b[0] == 'csrftoken') {
			token = b[1]
			}
		}

		var filters = document.querySelectorAll('.filter')

		function check_filter(){
			let check_val = 0
			for (let i = 0; i < filters.length; i++){
				if (filters[i].value){
					check_val += 1
				}
			}
			return check_val
		}

		if (check_filter()){
			$('.clear').removeAttr('hidden')
		}else{
			$('.clear').attr('hidden', 'true')
		}

		for (let i = 0; i < filters.length; i++){
			filters[i].addEventListener('input', function(){
				if (filters[i].value){
					$('.clear').removeAttr('hidden')
				}else{
					$('.clear').attr('hidden', 'true')
				}
			})
		};

		function cleare_filter(){
			for (let i=0; i<filters.length; i++){
				if (filters[i].value){
					filters[i].removeAttribute('value');
					filters[i].value = '';
				}
			};
		}

		function checkCollapse() {
		    $.ajax(
			    {
			  	    url: url,
			  	    method: 'GET',
			  	    data: {
					    csrfmiddlewaretoken: token,
					    collapse: 1
			  	    }
			    }
		    ).then(function(result) {
			    var x = 1;
		    }).catch(function(err) {
				var x = 1;
		    });
		};
	</script>

	<script type="text/javascript">
		$(function(){
			$("#datepicker").datepicker();
			$("#datepicker1").datepicker();
		});
	</script>

	<script>
		var dirtly_url = new URL(location);
		var dirtly_params = dirtly_url.searchParams;
		var new_params = '?';

		dirtly_params.forEach((val, key) =>{
			if (val){
				new_params += key+'='+val+'&'
			}
		})

		new_params = new_params.slice(0, -1);

		var new_url = new URL(new_params, location);

		history.pushState(null, null, new_url);

		var btnLimEl = document.querySelectorAll('.checkLimitButton');
		for (let i = 0; i < btnLimEl.length; i++){
			btnLimEl[i].addEventListener('click', function(event) {
				if (event.target == btnLimEl[i]){
					console.log(btnLimEl[i].getAttribute("id"))
					$.ajax(
					{
						url: url,
						method: 'POST',
						data: {
						csrfmiddlewaretoken: token,
						type: btnLimEl[i].getAttribute("id")
						}
					}
					).then(function(result) {
						var x = document.location.search.split('&page')[0];
						x = x.split('?page')[0];
						document.location.href = document.location.origin + document.location.pathname + x;
					}).catch(function(err) {
						var x = 1;
					})
				}
			})
		};

	</script>

	<script>
		// Модалка для просмотра чеков
		var exampleModal = document.getElementById('exampleModal')
		var modalTitle = exampleModal.querySelector('.modal-header')
		var modalBody = exampleModal.querySelector('.modal-body')

		var exampleModalsBtn = document.getElementsByClassName('CheckPhotoModal')
		
		for(let i=0; i<exampleModalsBtn.length; i++){
			exampleModalsBtn[i].addEventListener('click', function(event){
				if(event.currentTarget == exampleModalsBtn[i]){
					var linkData = exampleModalsBtn[i].getAttribute('data-bs-whatever')
					var transactionName = exampleModalsBtn[i].getAttribute('data-bs-transaction-name')
					modalTitle.textContent = `Чек транзакции - ${transactionName}`
					modalBody.innerHTML = `<div class="row"><img src=${linkData}></div>`
				}
			})
		}

	</script>

{% endblock content %}
